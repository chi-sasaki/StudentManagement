<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="raisetech.StudentManagement.repository.StudentRepository">

    <!-- 受講生の全件検索 -->
    <select id="search" resultType="raisetech.StudentManagement.date.Student">
        SELECT * FROM students
    </select>

    <!-- 受講生の単一検索 -->
    <select id="searchStudent" resultType="raisetech.StudentManagement.date.Student">
        SELECT * FROM students WHERE student_id = #{studentId}
    </select>

    <!-- 受講生コースの全件検索 -->
    <select id="searchCourseList" resultType="raisetech.StudentManagement.date.StudentCourse">
        SELECT * FROM students_courses
    </select>

    <!-- 受講生コースの単一検索 -->
    <select id="searchStudentCourse" resultType="raisetech.StudentManagement.date.StudentCourse">
        SELECT * FROM students_courses WHERE student_id = #{studentId}
    </select>

    <!-- 学生登録 -->
    <insert id="registerStudent" parameterType="raisetech.StudentManagement.date.Student"
            useGeneratedKeys="true" keyProperty="studentId">
        INSERT INTO students (full_name, furigana, nickname, email_address, city, age, gender, remark, is_deleted)
        VALUES
        (#{fullName},#{furigana},#{nickname},#{emailAddress},#{city},#{age},#{gender},#{remark},false)
    </insert>

    <!-- コース登録 -->
    <insert id="registerCourse" parameterType="raisetech.StudentManagement.date.StudentCourse"
            useGeneratedKeys ="true" keyProperty = "courseId">
        INSERT INTO students_courses(student_id, course_name, course_start_date, course_completion_date)
        VALUES
        (#{studentId}, #{courseName}, #{courseStartDate}, #{courseCompletionDate})
    </insert>

    <!-- 学生情報更新 -->
    <update id="updateStudent" parameterType="raisetech.StudentManagement.date.Student">
        UPDATE students
        SET
        full_name = #{fullName}, furigana = #{furigana}, nickname = #{nickname}, email_address = #{emailAddress},
        city = #{city}, age = #{age}, gender = #{gender}, remark = #{remark}, is_deleted = #{isDeleted}
        WHERE
        student_id = #{studentId}
    </update>

    <!-- コース情報更新 -->
    <update id="updateCourse" parameterType="raisetech.StudentManagement.date.StudentCourse">
        UPDATE students_courses
        SET
        course_name = #{courseName}
        WHERE
        course_id = #{courseId}
    </update>

    <!-- 学生情報の重複確認 -->
    <select id="existsStudentId" parameterType="string" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM students
        WHERE student_id = #{studentId}
    </select>
</mapper>